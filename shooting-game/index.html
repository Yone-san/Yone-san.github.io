<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>シューティングゲーム</title>
		<style>
			* {margin:0; padding:0;}
			p{text-align:center;}
			#canvas1{
				background-image: url(bg.png);
				background-size: 100% 100%;
			}
		</style>
	</head>
	<body>
		<p><canvas id="canvas1" width="320" height="480"></canvas></p>
		
		<script>
			var canvas1 = document.getElementById("canvas1");
			var ctx1 = canvas1.getContext("2d");

			//①変数の設定と初期化
			var target  = {x:250, y:100, dir:1}; //ターゲットのxy位置と移動方向
			var shooter = {x:250, y:400};        //射手のxy位置
			var bullet  = {x:-10, y:-10};        //弾丸のxy位置
			var point   = 0;                     //得点

			var targetImage  = new Image();
			var shooterImage = new Image();
			var bulletImage  = new Image();

			targetImage.src  = "target.png";
			shooterImage.src = "shooter.png";
			bulletImage.src  = "bullet.png";
			
			var score   = new Audio();
			var gunshot = new Audio();
			var loading = new Audio();

			score.src   = "score.mp3";
			gunshot.src = "gunshot.mp3";
			loading.src = "loading.mp3";

			//②一定時間毎にプログラムgame1を起動させる
			setInterval(game1,50);

			//③game1関数
			function game1(){
				ctx1.clearRect(0,0,320,480);

				//描画(ターゲット)
				ctx1.drawImage(targetImage,target.x-25,target.y-25,80,80);

				//描画(得点)
				ctx1.fillStyle = "black";
				ctx1.font = "20px sans-serif";
				ctx1.fillText(point,target.x-10,target.y-10);

				//描画(射手)
				ctx1.drawImage(shooterImage,shooter.x-25,shooter.y-25,80,80);

				//描画(弾丸)
				ctx1.drawImage(bulletImage,bullet.x-5,bullet.y-5,20,20);

				//移動計算
				target.x += target.dir;
				bullet.y -= 5;

				if(target.x < 25 || 295 < target.x){target.dir *= -1;}

				//得点計算
				if((bullet.y === 100) && (Math.abs(target.x - bullet.x) < 25)){
					point++;
					score.play();
				}
			}

			//④シュート関数
			canvas1.addEventListener("mousedown",function(){
				bullet.x = shooter.x;
				bullet.y = shooter.y;
				gunshot.play();
				loading.play();
			});

			//⑤プレイヤーコントロール
			canvas1.addEventListener("mousemove",function(e){
				var rect = e.target.getBoundingClientRect();
				shooter.x = e.clientX-rect.left;
			});
		</script>
	</body>
</html>
